{
  "name": "EROS: Profile Pattern Analyzer",
  "nodes": [
    {
      "id": "webhook-trigger-001",
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "position": [200, 400],
      "parameters": {
        "path": "eros/analyze-profile",
        "responseMode": "responseNode",
        "options": {}
      },
      "typeVersion": 1.1,
      "webhookId": "eros-profile-analyzer"
    },
    {
      "id": "sticky-setup-001",
      "name": "Setup Instructions",
      "type": "n8n-nodes-base.stickyNote",
      "position": [180, 200],
      "parameters": {
        "color": 5,
        "width": 400,
        "height": 180,
        "content": "## üéØ EROS Profile Pattern Analyzer\n\n**INPUT:** POST to webhook\n```json\n{\n  \"instagram_url\": \"https://instagram.com/profile\",\n  \"additional_context\": \"Optional notes\"\n}\n```\n\n**OUTPUT:** Complete archetypal analysis"
      },
      "typeVersion": 1
    },
    {
      "id": "extract-username-001",
      "name": "Extract Username",
      "type": "n8n-nodes-base.code",
      "position": [400, 400],
      "parameters": {
        "language": "javaScript",
        "jsCode": "// Extract Instagram username from URL\nconst url = $input.item.json.body.instagram_url;\nconst username = url.match(/instagram\\.com\\/([^\\/\\?]+)/)?.[1] || '';\n\nreturn {\n  instagram_url: url,\n  username: username,\n  additional_context: $input.item.json.body.additional_context || ''\n};"
      },
      "typeVersion": 2
    },
    {
      "id": "scrape-profile-001",
      "name": "Scrape Instagram Profile",
      "type": "n8n-nodes-base.httpRequest",
      "position": [600, 400],
      "parameters": {
        "url": "=https://www.instagram.com/{{ $json.username }}/?__a=1&__d=dis",
        "method": "GET",
        "options": {
          "timeout": 30000,
          "redirect": {
            "redirect": {
              "followRedirects": true,
              "maxRedirects": 5
            }
          }
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
            }
          ]
        }
      },
      "typeVersion": 4.2,
      "onError": "continueErrorOutput"
    },
    {
      "id": "parse-instagram-data-001",
      "name": "Parse Instagram Data",
      "type": "n8n-nodes-base.code",
      "position": [800, 400],
      "parameters": {
        "language": "javaScript",
        "jsCode": "// Parse Instagram profile data\n// Note: Real implementation would handle actual Instagram API/scraping\n// This is a template structure\n\nconst mockData = {\n  bio: \"Sample bio text\",\n  posts: [\n    {\n      caption: \"Sample post caption\",\n      image_url: \"https://example.com/image.jpg\",\n      location: \"Sample Location\",\n      hashtags: [\"#sample\", \"#hashtag\"]\n    }\n  ],\n  follower_count: 1000,\n  following_count: 500,\n  post_count: 50\n};\n\n// In production, parse actual scraped data\nconst profileData = $input.item.json.error \n  ? mockData \n  : ($input.item.json.graphql?.user || mockData);\n\nreturn {\n  username: $('Extract Username').item.json.username,\n  bio: profileData.biography || profileData.bio || '',\n  posts: profileData.edge_owner_to_timeline_media?.edges?.slice(0, 30).map(edge => ({\n    caption: edge.node.edge_media_to_caption?.edges[0]?.node?.text || '',\n    likes: edge.node.edge_liked_by?.count || 0,\n    location: edge.node.location?.name || '',\n    timestamp: edge.node.taken_at_timestamp\n  })) || mockData.posts,\n  follower_count: profileData.edge_followed_by?.count || profileData.follower_count,\n  following_count: profileData.edge_follow?.count || profileData.following_count,\n  post_count: profileData.edge_owner_to_timeline_media?.count || profileData.post_count,\n  additional_context: $('Extract Username').item.json.additional_context\n};"
      },
      "typeVersion": 2
    },
    {
      "id": "prepare-claude-prompt-001",
      "name": "Prepare Claude Analysis Prompt",
      "type": "n8n-nodes-base.code",
      "position": [1000, 400],
      "parameters": {
        "language": "javaScript",
        "jsCode": "const data = $input.item.json;\n\n// Extract hashtags and locations\nconst allHashtags = data.posts\n  .flatMap(p => p.caption.match(/#\\w+/g) || [])\n  .slice(0, 30);\n\nconst locations = [...new Set(data.posts\n  .map(p => p.location)\n  .filter(Boolean)\n)];\n\nconst captions = data.posts\n  .map(p => p.caption)\n  .filter(Boolean)\n  .slice(0, 20);\n\nconst systemPrompt = `Voc√™ √© um analista comportamental especializado em arqu√©tipos femininos junguianos aplicados ao contexto moderno brasileiro.\n\n# FRAMEWORK DE ARQU√âTIPOS\n\n## 1. HETAIRA (Amante-Companheira)\nIndicadores:\n- Posts sobre: relacionamentos, viagens rom√¢nticas, experi√™ncias sensoriais\n- Linguagem: sensual sem ser vulgar, aprecia√ß√£o est√©tica\n- Visual: fotos bem produzidas, aten√ß√£o a detalhes est√©ticos\n- Valores: beleza, prazer, conex√£o, intensidade\n\n## 2. DONZELA (Inoc√™ncia-Alegria)\nIndicadores:\n- Posts sobre: natureza, amigos, momentos leves, divers√£o\n- Linguagem: emojis frequentes, exclama√ß√µes, otimismo\n- Visual: cores vibrantes, sorrisos, cen√°rios ao ar livre\n- Valores: leveza, autenticidade, espontaneidade\n\n## 3. M√ÉE (Nutridora-Protetora)\nIndicadores:\n- Posts sobre: fam√≠lia, cuidado com outros, causas sociais\n- Linguagem: acolhedora, emp√°tica, preocupada\n- Visual: fotos com crian√ßas/animais/grupos, ambientes caseiros\n- Valores: prote√ß√£o, nutri√ß√£o, comunidade\n\n## 4. AMAZONA (Guerreira-Conquistadora)\nIndicadores:\n- Posts sobre: conquistas, desafios, trabalho, esportes\n- Linguagem: competitiva, assertiva, focada em resultados\n- Visual: academia, escrit√≥rio, competi√ß√µes, viagens de trabalho\n- Valores: independ√™ncia, conquista, autonomia\n\n## 5. SACERDOTISA (M√≠stica-Intuitiva)\nIndicadores:\n- Posts sobre: espiritualidade, autoconhecimento, filosofia\n- Linguagem: introspectiva, po√©tica, simb√≥lica\n- Visual: natureza contemplativa, arte, s√≠mbolos espirituais\n- Valores: profundidade, mist√©rio, transforma√ß√£o\n\n## 6. MEDUSA (Sedutora-Manipuladora)\nIndicadores:\n- Posts sobre: poder, sedu√ß√£o expl√≠cita, provoca√ß√£o\n- Linguagem: desafiadora, enigm√°tica, controladora\n- Visual: poses provocantes, jogos de poder visual\n- Valores: controle, poder, sedu√ß√£o como arma\n\n## 7. ATENA (Estrategista-Intelectual)\nIndicadores:\n- Posts sobre: conhecimento, estrat√©gia, an√°lise, cultura\n- Linguagem: articulada, conceitual, refer√™ncias culturais\n- Visual: livros, museus, debates, eventos intelectuais\n- Valores: sabedoria, estrat√©gia, racionalidade\n\n# REGRAS CR√çTICAS\n- Seja ESPEC√çFICO, n√£o gen√©rico\n- Base-se em EVID√äNCIAS do feed, n√£o suposi√ß√µes\n- Identifique padr√µes que ELA pode n√£o ver em si mesma\n- Seja √âTICO - insights para conex√£o genu√≠na, n√£o manipula√ß√£o\n- Se dados insuficientes, indique \"INSUFFICIENT_DATA\" em campos espec√≠ficos`;\n\nconst userPrompt = `Analise o seguinte perfil do Instagram e retorne an√°lise arquet√≠pica completa.\n\n# DADOS DO PERFIL\n\n**Username:** ${data.username}\n\n**Bio:** ${data.bio}\n\n**Estat√≠sticas:**\n- Seguidores: ${data.follower_count}\n- Seguindo: ${data.following_count}\n- Posts: ${data.post_count}\n\n**√öltimos Posts (captions):**\n${captions.map((c, i) => `${i+1}. ${c.substring(0, 200)}`).join('\\n\\n')}\n\n**Hashtags Frequentes:**\n${allHashtags.join(', ')}\n\n**Localiza√ß√µes:**\n${locations.join(', ')}\n\n**Contexto Adicional:**\n${data.additional_context}\n\n---\n\n# TAREFA\n\nRetorne an√°lise completa em formato JSON seguindo esta estrutura EXATA:\n\n\\`\\`\\`json\n{\n  \"archetypal_profile\": {\n    \"primary\": {\n      \"name\": \"Nome do arqu√©tipo\",\n      \"percentage\": 0-100,\n      \"evidence\": [\"evid√™ncia 1\", \"evid√™ncia 2\", \"evid√™ncia 3\"],\n      \"manifestation\": \"Como esse arqu√©tipo se manifesta nela especificamente\"\n    },\n    \"secondary\": {\n      \"name\": \"Nome do arqu√©tipo\",\n      \"percentage\": 0-100,\n      \"evidence\": [\"evid√™ncia 1\", \"evid√™ncia 2\"],\n      \"manifestation\": \"...\"\n    },\n    \"tertiary\": {\n      \"name\": \"Nome do arqu√©tipo\",\n      \"percentage\": 0-100,\n      \"evidence\": [\"evid√™ncia 1\"],\n      \"manifestation\": \"...\"\n    },\n    \"shadow_aspects\": [\n      \"Aspectos que ela pode estar reprimindo/evitando\"\n    ]\n  },\n  \"lifestyle_markers\": {\n    \"social_class\": \"A/B/C com justificativa\",\n    \"exposure_level\": 1-10,\n    \"social_circle_type\": \"descri√ß√£o do tipo de pessoas com quem convive\",\n    \"primary_interests\": [\"interesse 1\", \"interesse 2\"],\n    \"value_system\": [\"valor 1\", \"valor 2\", \"valor 3\"]\n  },\n  \"unconscious_patterns\": [\n    {\n      \"pattern\": \"Padr√£o que ela repete mas pode n√£o perceber\",\n      \"evidence\": \"O que no feed mostra isso\",\n      \"opportunity\": \"Como voc√™ pode usar isso a seu favor eticamente\"\n    }\n  ],\n  \"aesthetic_signature\": {\n    \"color_palette\": [\"cor dominante\", \"cor secund√°ria\"],\n    \"environments\": [\"ambiente 1\", \"ambiente 2\"],\n    \"visual_style\": \"descri√ß√£o do estilo visual\",\n    \"production_level\": \"low/medium/high\"\n  },\n  \"relationship_indicators\": {\n    \"attachment_style_hypothesis\": \"seguro/ansioso/evitativo com justificativa\",\n    \"relationship_readiness\": 1-10,\n    \"what_she_seeks\": [\"caracter√≠stica 1\", \"caracter√≠stica 2\"],\n    \"red_flags_detected\": [\"flag 1 se houver\"]\n  },\n  \"strategic_insights\": {\n    \"attraction_triggers\": [\n      \"Gatilho 1 baseado nos arqu√©tipos\",\n      \"Gatilho 2 baseado no lifestyle\",\n      \"Gatilho 3 baseado nos padr√µes inconscientes\"\n    ],\n    \"approach_strategy\": \"Estrat√©gia espec√≠fica de aproxima√ß√£o\",\n    \"conversation_hooks\": [\"assunto 1\", \"assunto 2\", \"assunto 3\"],\n    \"places_to_intersect\": [\"lugar/evento 1\", \"lugar/evento 2\"]\n  }\n}\n\\`\\`\\`\n\nRetorne APENAS o JSON, sem texto adicional.`;\n\nreturn {\n  system_prompt: systemPrompt,\n  user_prompt: userPrompt,\n  username: data.username\n};"
      },
      "typeVersion": 2
    },
    {
      "id": "claude-analysis-001",
      "name": "Claude Archetypal Analysis",
      "type": "n8n-nodes-base.httpRequest",
      "position": [1200, 400],
      "parameters": {
        "url": "https://api.anthropic.com/v1/messages",
        "method": "POST",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "={{ $credentials.anthropicApi.apiKey }}"
            },
            {
              "name": "anthropic-version",
              "value": "2023-06-01"
            },
            {
              "name": "content-type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"claude-sonnet-4-5-20250929\",\n  \"max_tokens\": 4096,\n  \"temperature\": 0.7,\n  \"system\": {{ $json.system_prompt | quote }},\n  \"messages\": [\n    {\n      \"role\": \"user\",\n      \"content\": {{ $json.user_prompt | quote }}\n    }\n  ]\n}",
        "options": {}
      },
      "typeVersion": 4.2,
      "credentials": {
        "anthropicApi": {
          "id": "anthropic-api-cred",
          "name": "Anthropic API"
        }
      }
    },
    {
      "id": "parse-claude-response-001",
      "name": "Parse Claude Response",
      "type": "n8n-nodes-base.code",
      "position": [1400, 400],
      "parameters": {
        "language": "javaScript",
        "jsCode": "const response = $input.item.json;\nconst content = response.content[0].text;\n\n// Extract JSON from response (Claude might wrap it in markdown)\nlet jsonText = content;\nconst jsonMatch = content.match(/```json\\s*([\\s\\S]*?)\\s*```/);\nif (jsonMatch) {\n  jsonText = jsonMatch[1];\n}\n\nlet analysis;\ntry {\n  analysis = JSON.parse(jsonText);\n} catch (error) {\n  // If parsing fails, return error structure\n  analysis = {\n    error: \"Failed to parse analysis\",\n    raw_response: content\n  };\n}\n\nreturn {\n  username: $('Prepare Claude Analysis Prompt').item.json.username,\n  analysis: analysis,\n  analyzed_at: new Date().toISOString(),\n  tokens_used: {\n    input: response.usage.input_tokens,\n    output: response.usage.output_tokens\n  }\n};"
      },
      "typeVersion": 2
    },
    {
      "id": "store-in-database-001",
      "name": "Store in Database",
      "type": "n8n-nodes-base.code",
      "position": [1600, 400],
      "parameters": {
        "language": "javaScript",
        "jsCode": "// This would connect to Supabase in production\n// For now, just pass through the data\n\nconst result = $input.item.json;\n\n// In production:\n// - Store in Supabase prospects table\n// - Generate unique ID\n// - Track analysis history\n\nreturn {\n  success: true,\n  profile_id: 'generated-uuid',\n  username: result.username,\n  analysis: result.analysis,\n  analyzed_at: result.analyzed_at,\n  message: 'Profile analysis completed successfully'\n};"
      },
      "typeVersion": 2
    },
    {
      "id": "format-telegram-summary-001",
      "name": "Format Telegram Summary",
      "type": "n8n-nodes-base.code",
      "position": [1600, 550],
      "parameters": {
        "language": "javaScript",
        "jsCode": "const data = $input.item.json;\nconst analysis = data.analysis;\n\nif (analysis.error) {\n  return {\n    message: `‚ùå Erro ao analisar perfil @${data.username}\\n\\n${analysis.error}`\n  };\n}\n\nconst primary = analysis.archetypal_profile.primary;\nconst secondary = analysis.archetypal_profile.secondary;\nconst lifestyle = analysis.lifestyle_markers;\nconst insights = analysis.strategic_insights;\n\nconst message = `üéØ *EROS Profile Analysis*\\n\\n*@${data.username}*\\n\\n*‚îÅ‚îÅ‚îÅ PERFIL ARQUET√çPICO ‚îÅ‚îÅ‚îÅ*\\n\\n*Prim√°rio:* ${primary.name} (${primary.percentage}%)\\n${primary.manifestation}\\n\\n*Secund√°rio:* ${secondary.name} (${secondary.percentage}%)\\n\\n*‚îÅ‚îÅ‚îÅ LIFESTYLE ‚îÅ‚îÅ‚îÅ*\\n\\n*Classe Social:* ${lifestyle.social_class}\\n*Exposi√ß√£o:* ${lifestyle.exposure_level}/10\\n*C√≠rculo:* ${lifestyle.social_circle_type}\\n*Interesses:* ${lifestyle.primary_interests.join(', ')}\\n\\n*‚îÅ‚îÅ‚îÅ ESTRAT√âGIA ‚îÅ‚îÅ‚îÅ*\\n\\n*Abordagem:*\\n${insights.approach_strategy}\\n\\n*Gatilhos de Atra√ß√£o:*\\n${insights.attraction_triggers.map((t, i) => `${i+1}. ${t}`).join('\\n')}\\n\\n*Conversation Hooks:*\\n${insights.conversation_hooks.map(h => `‚Ä¢ ${h}`).join('\\n')}\\n\\n*Lugares para Intersectar:*\\n${insights.places_to_intersect.map(p => `üìç ${p}`).join('\\n')}\\n\\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n‚è± Analisado em: ${new Date(data.analyzed_at).toLocaleString('pt-BR')}`;\n\nreturn { message };"
      },
      "typeVersion": 2
    },
    {
      "id": "send-telegram-notification-001",
      "name": "Send Telegram Notification",
      "type": "n8n-nodes-base.telegram",
      "position": [1800, 550],
      "parameters": {
        "text": "={{ $json.message }}",
        "chatId": "YOUR_CHAT_ID",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "Markdown"
        }
      },
      "credentials": {
        "telegramApi": {
          "id": "telegram-api-cred",
          "name": "Telegram Bot API"
        }
      },
      "typeVersion": 1.2
    },
    {
      "id": "webhook-response-001",
      "name": "Webhook Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [1800, 400],
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "typeVersion": 1
    },
    {
      "id": "sticky-credentials-001",
      "name": "Credentials Setup",
      "type": "n8n-nodes-base.stickyNote",
      "position": [180, 600],
      "parameters": {
        "color": 6,
        "width": 400,
        "height": 120,
        "content": "## ‚öôÔ∏è Required Credentials\n\n1. **Anthropic API** - Claude API key\n2. **Telegram Bot API** - Bot token\n3. Set your Telegram Chat ID in the Telegram node"
      },
      "typeVersion": 1
    }
  ],
  "connections": {
    "Webhook Trigger": {
      "main": [
        [
          {
            "node": "Extract Username",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Username": {
      "main": [
        [
          {
            "node": "Scrape Instagram Profile",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Scrape Instagram Profile": {
      "main": [
        [
          {
            "node": "Parse Instagram Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Instagram Data": {
      "main": [
        [
          {
            "node": "Prepare Claude Analysis Prompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Claude Analysis Prompt": {
      "main": [
        [
          {
            "node": "Claude Archetypal Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Claude Archetypal Analysis": {
      "main": [
        [
          {
            "node": "Parse Claude Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Claude Response": {
      "main": [
        [
          {
            "node": "Store in Database",
            "type": "main",
            "index": 0
          },
          {
            "node": "Format Telegram Summary",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Store in Database": {
      "main": [
        [
          {
            "node": "Webhook Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Telegram Summary": {
      "main": [
        [
          {
            "node": "Send Telegram Notification",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2025-11-23T00:00:00.000Z",
      "updatedAt": "2025-11-23T00:00:00.000Z",
      "id": "eros-engine",
      "name": "EROS Engine"
    }
  ],
  "meta": {
    "templateCredsSetupCompleted": false,
    "instanceId": "eros-engine-instance"
  },
  "id": "eros-profile-analyzer",
  "createdAt": "2025-11-23T00:00:00.000Z",
  "updatedAt": "2025-11-23T00:00:00.000Z"
}
