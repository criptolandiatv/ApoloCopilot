{
  "name": "EROS: Gap Analysis & Action Plan",
  "nodes": [
    {
      "id": "webhook-trigger-002",
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "position": [200, 400],
      "parameters": {
        "path": "eros/gap-analysis",
        "responseMode": "responseNode",
        "options": {}
      },
      "typeVersion": 1.1,
      "webhookId": "eros-gap-analysis"
    },
    {
      "id": "sticky-setup-002",
      "name": "Setup Instructions",
      "type": "n8n-nodes-base.stickyNote",
      "position": [180, 200],
      "parameters": {
        "color": 5,
        "width": 450,
        "height": 220,
        "content": "## üìä EROS Gap Analysis & Action Plan\n\n**INPUT:** POST to webhook\n```json\n{\n  \"target_profile\": { ...analysis from analyzer... },\n  \"self_assessment\": {\n    \"career_status\": \"1-10 + description\",\n    \"financial_security\": \"1-10\",\n    \"body_condition\": \"1-10\",\n    \"emotional_stability\": \"1-10\",\n    \"social_circle_quality\": \"1-10\"\n  }\n}\n```"
      },
      "typeVersion": 1
    },
    {
      "id": "validate-input-002",
      "name": "Validate Input",
      "type": "n8n-nodes-base.code",
      "position": [400, 400],
      "parameters": {
        "language": "javaScript",
        "jsCode": "const body = $input.item.json.body;\n\nif (!body.target_profile || !body.self_assessment) {\n  throw new Error('Missing required fields: target_profile and self_assessment');\n}\n\nreturn {\n  target_profile: body.target_profile,\n  self_assessment: body.self_assessment,\n  analysis_date: new Date().toISOString()\n};"
      },
      "typeVersion": 2
    },
    {
      "id": "prepare-gap-analysis-prompt-002",
      "name": "Prepare Gap Analysis Prompt",
      "type": "n8n-nodes-base.code",
      "position": [600, 400],
      "parameters": {
        "language": "javaScript",
        "jsCode": "const data = $input.item.json;\nconst targetProfile = data.target_profile;\nconst selfAssessment = data.self_assessment;\n\nconst systemPrompt = `Voc√™ √© um estrategista de desenvolvimento pessoal masculino focado em atratividade para relacionamentos de alto calibre.\n\n# FRAMEWORK DE MASCULINIDADE ATRATIVA\n\n## PILARES FUNDAMENTAIS\n\n### 1. EIXO ESTRUTURAL (Foundation)\n- Miss√£o Clara: tem projeto de vida al√©m do relacionamento?\n- Estabilidade Financeira: consegue bancar lifestyle sem stress?\n- Autonomia Emocional: n√£o depende dela pra valida√ß√£o?\n\n### 2. MAGNETISMO SOCIAL (Presence)\n- Sociabilidade Calibrada: confort√°vel em grupos, eventos, viagens?\n- Network de Valor: c√≠rculo social que agrega ou diminui?\n- Lideran√ßa Situacional: puxa rol√™ ou espera ser puxado?\n\n### 3. EST√âTICA INTENCIONAL (Presentation)\n- Corpo Cuidado: academia, postura, energia f√≠sica?\n- Estilo Coerente: roupa/barba/cabelo pensado ou desleixado?\n- Presen√ßa Visual: fotografa bem? Sabe ocupar espa√ßo?\n\n### 4. PROFUNDIDADE EMOCIONAL (Depth)\n- Auto-Conhecimento: faz terapia? Conhece seus padr√µes?\n- Regula√ß√£o Emocional: consegue segurar a onda ou surta f√°cil?\n- Vulnerabilidade Estrat√©gica: abre-se na medida certa?\n\n### 5. CAPITAL CULTURAL (Substance)\n- Repert√≥rio: consegue conversar sobre arte, mundo, cultura?\n- Curiosidade Genu√≠na: interesse real por aprender coisas?\n- Experi√™ncias: tem hist√≥rias interessantes pra contar?\n\n# REGRAS CR√çTICAS\n- Seja BRUTAL e honesto nos gaps - delicadeza n√£o serve aqui\n- Toda a√ß√£o deve ser ESPEC√çFICA e MENSUR√ÅVEL\n- Foque em mudan√ßas REAIS, n√£o coaching motivacional gen√©rico\n- Equilibre \"seja voc√™ mesmo\" com \"evolua estrategicamente\"\n- √âTICA: tudo deve visar conex√£o genu√≠na, n√£o manipula√ß√£o`;\n\nconst userPrompt = `Analise a compatibilidade atual e crie plano de a√ß√£o para fechar gaps.\n\n# PERFIL DELA (Target)\n\n${JSON.stringify(targetProfile, null, 2)}\n\n# PERFIL DELE (Atual)\n\n**Profissional:**\n- Status de carreira: ${selfAssessment.career_status}\n- Seguran√ßa financeira: ${selfAssessment.financial_security}/10\n\n**Social:**\n- Qualidade c√≠rculo social: ${selfAssessment.social_circle_quality}/10\n- Frequ√™ncia eventos: ${selfAssessment.event_frequency || 'n√£o informado'}\n\n**F√≠sico:**\n- Condi√ß√£o f√≠sica: ${selfAssessment.body_condition}/10\n- N√≠vel de estilo: ${selfAssessment.style_intentionality || 'n√£o informado'}/10\n\n**Emocional:**\n- Estabilidade emocional: ${selfAssessment.emotional_stability}/10\n- Auto-conhecimento: ${selfAssessment.self_awareness_level || 'n√£o informado'}/10\n\n**Lifestyle:**\n- Viagens/ano: ${selfAssessment.adventure_frequency || 'n√£o informado'}\n- Engajamento cultural: ${selfAssessment.cultural_engagement || 'n√£o informado'}\n\n---\n\n# TAREFA\n\nRetorne an√°lise completa em formato JSON:\n\n\\`\\`\\`json\n{\n  \"compatibility_score\": {\n    \"overall\": 0-100,\n    \"breakdown\": {\n      \"archetypal_match\": 0-100,\n      \"lifestyle_match\": 0-100,\n      \"values_match\": 0-100,\n      \"aesthetic_match\": 0-100\n    },\n    \"verdict\": \"READY / NEAR_READY / SIGNIFICANT_GAPS / NOT_READY\",\n    \"reasoning\": \"explica√ß√£o detalhada do score\"\n  },\n  \"gap_analysis\": {\n    \"critical_gaps\": [\n      {\n        \"pillar\": \"nome do pilar\",\n        \"current_state\": \"descri√ß√£o + score 1-10\",\n        \"required_state\": \"descri√ß√£o + score 1-10\",\n        \"gap_size\": \"CRITICAL / MODERATE / MINOR\",\n        \"impact_on_attraction\": \"HIGH / MEDIUM / LOW\",\n        \"specific_deficiency\": \"o que especificamente est√° faltando\"\n      }\n    ],\n    \"strengths_to_leverage\": [\n      \"for√ßa atual que j√° o posiciona bem\"\n    ]\n  },\n  \"action_plan\": {\n    \"quick_wins_30_days\": [\n      {\n        \"action\": \"a√ß√£o espec√≠fica e mensur√°vel\",\n        \"pillar\": \"qual pilar atende\",\n        \"effort\": \"horas/semana necess√°rias\",\n        \"expected_impact\": \"o que muda\",\n        \"how_to_implement\": \"passo a passo\"\n      }\n    ],\n    \"strategic_investments_90_days\": [\n      {\n        \"action\": \"...\",\n        \"pillar\": \"...\",\n        \"effort\": \"...\",\n        \"expected_impact\": \"...\",\n        \"milestones\": [\"marco 1\", \"marco 2\", \"marco 3\"]\n      }\n    ],\n    \"long_term_building_6_12_months\": [\n      {\n        \"domain\": \"√°rea de desenvolvimento\",\n        \"goal\": \"objetivo espec√≠fico\",\n        \"why_it_matters\": \"impacto na atratividade\",\n        \"roadmap\": [\"fase 1\", \"fase 2\", \"fase 3\"]\n      }\n    ]\n  },\n  \"strategic_positioning\": {\n    \"narrative_framework\": {\n      \"origin_story\": \"como contar de onde veio\",\n      \"current_chapter\": \"o que est√° construindo agora\",\n      \"future_vision\": \"pra onde est√° indo\",\n      \"key_messages\": [\"mensagem 1\", \"mensagem 2\", \"mensagem 3\"]\n    },\n    \"social_proof_roadmap\": {\n      \"instagram_strategy\": {\n        \"content_pillars\": [\"pilar 1\", \"pilar 2\", \"pilar 3\"],\n        \"aesthetic_direction\": \"descri√ß√£o do visual/vibe\",\n        \"posting_frequency\": \"X posts/semana\"\n      },\n      \"network_cultivation\": {\n        \"target_circles\": [\"c√≠rculo 1\", \"c√≠rculo 2\"],\n        \"events_to_attend\": [\"evento 1\", \"evento 2\"]\n      }\n    },\n    \"intersection_design\": {\n      \"primary_venues\": [\n        {\n          \"place\": \"nome do lugar/evento\",\n          \"why\": \"por que ela est√° l√°\",\n          \"frequency\": \"quantas vezes ir\",\n          \"approach\": \"como se posicionar l√°\"\n        }\n      ]\n    }\n  },\n  \"approach_playbook\": {\n    \"first_interaction\": {\n      \"ideal_context\": \"situa√ß√£o ideal pra primeira intera√ß√£o\",\n      \"opening_strategy\": \"como iniciar conversa\",\n      \"conversation_hooks\": [\"assunto 1\", \"assunto 2\"],\n      \"what_to_avoid\": [\"erro 1\", \"erro 2\"]\n    },\n    \"communication_style\": {\n      \"text_game\": \"tom e frequ√™ncia de mensagens\",\n      \"depth_balance\": \"quando ser profundo vs leve\"\n    }\n  },\n  \"measurement_framework\": {\n    \"kpis_to_track\": [\n      {\n        \"metric\": \"m√©trica espec√≠fica\",\n        \"current\": \"valor atual\",\n        \"target_30_days\": \"meta\",\n        \"how_to_measure\": \"como medir\"\n      }\n    ]\n  }\n}\n\\`\\`\\`\n\nRetorne APENAS o JSON, sem texto adicional.`;\n\nreturn {\n  system_prompt: systemPrompt,\n  user_prompt: userPrompt,\n  analysis_date: data.analysis_date\n};"
      },
      "typeVersion": 2
    },
    {
      "id": "claude-gap-analysis-002",
      "name": "Claude Gap Analysis",
      "type": "n8n-nodes-base.httpRequest",
      "position": [800, 400],
      "parameters": {
        "url": "https://api.anthropic.com/v1/messages",
        "method": "POST",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "={{ $credentials.anthropicApi.apiKey }}"
            },
            {
              "name": "anthropic-version",
              "value": "2023-06-01"
            },
            {
              "name": "content-type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"claude-sonnet-4-5-20250929\",\n  \"max_tokens\": 8192,\n  \"temperature\": 0.7,\n  \"system\": {{ $json.system_prompt | quote }},\n  \"messages\": [\n    {\n      \"role\": \"user\",\n      \"content\": {{ $json.user_prompt | quote }}\n    }\n  ]\n}",
        "options": {}
      },
      "typeVersion": 4.2,
      "credentials": {
        "anthropicApi": {
          "id": "anthropic-api-cred",
          "name": "Anthropic API"
        }
      }
    },
    {
      "id": "parse-gap-analysis-002",
      "name": "Parse Gap Analysis",
      "type": "n8n-nodes-base.code",
      "position": [1000, 400],
      "parameters": {
        "language": "javaScript",
        "jsCode": "const response = $input.item.json;\nconst content = response.content[0].text;\n\n// Extract JSON from response\nlet jsonText = content;\nconst jsonMatch = content.match(/```json\\s*([\\s\\S]*?)\\s*```/);\nif (jsonMatch) {\n  jsonText = jsonMatch[1];\n}\n\nlet analysis;\ntry {\n  analysis = JSON.parse(jsonText);\n} catch (error) {\n  analysis = {\n    error: \"Failed to parse gap analysis\",\n    raw_response: content\n  };\n}\n\nreturn {\n  gap_analysis: analysis,\n  analyzed_at: $('Prepare Gap Analysis Prompt').item.json.analysis_date,\n  tokens_used: {\n    input: response.usage.input_tokens,\n    output: response.usage.output_tokens\n  }\n};"
      },
      "typeVersion": 2
    },
    {
      "id": "store-analysis-002",
      "name": "Store Analysis",
      "type": "n8n-nodes-base.code",
      "position": [1200, 400],
      "parameters": {
        "language": "javaScript",
        "jsCode": "// Store in database (Supabase in production)\nconst result = $input.item.json;\n\nreturn {\n  success: true,\n  analysis_id: 'generated-uuid',\n  gap_analysis: result.gap_analysis,\n  analyzed_at: result.analyzed_at,\n  message: 'Gap analysis completed successfully'\n};"
      },
      "typeVersion": 2
    },
    {
      "id": "format-telegram-report-002",
      "name": "Format Telegram Report",
      "type": "n8n-nodes-base.code",
      "position": [1200, 550],
      "parameters": {
        "language": "javaScript",
        "jsCode": "const data = $input.item.json;\nconst analysis = data.gap_analysis;\n\nif (analysis.error) {\n  return {\n    message: `‚ùå Erro ao gerar gap analysis\\n\\n${analysis.error}`\n  };\n}\n\nconst compat = analysis.compatibility_score;\nconst gaps = analysis.gap_analysis;\nconst plan = analysis.action_plan;\n\n// Emoji based on verdict\nconst verdictEmoji = {\n  'READY': '‚úÖ',\n  'NEAR_READY': 'üü°',\n  'SIGNIFICANT_GAPS': 'üü†',\n  'NOT_READY': 'üî¥'\n};\n\nconst message = `üìä *EROS Gap Analysis Report*\\n\\n${verdictEmoji[compat.verdict] || '‚ö™Ô∏è'} *COMPATIBILIDADE: ${compat.overall}/100*\\n\\n*Breakdown:*\\n‚Ä¢ Arqu√©tipos: ${compat.breakdown.archetypal_match}/100\\n‚Ä¢ Lifestyle: ${compat.breakdown.lifestyle_match}/100\\n‚Ä¢ Valores: ${compat.breakdown.values_match}/100\\n‚Ä¢ Est√©tica: ${compat.breakdown.aesthetic_match}/100\\n\\n*Status:* ${compat.verdict}\\n${compat.reasoning}\\n\\n*‚îÅ‚îÅ‚îÅ GAPS CR√çTICOS ‚îÅ‚îÅ‚îÅ*\\n\\n${gaps.critical_gaps.slice(0, 3).map((g, i) => \n  `*${i+1}. ${g.pillar}* (${g.gap_size})\\nüìç Atual: ${g.current_state}\\nüéØ Necess√°rio: ${g.required_state}\\nüí• Impacto: ${g.impact_on_attraction}\\n`\n).join('\\n')}\\n*‚îÅ‚îÅ‚îÅ QUICK WINS (30 dias) ‚îÅ‚îÅ‚îÅ*\\n\\n${plan.quick_wins_30_days.slice(0, 3).map((action, i) => \n  `*${i+1}. ${action.action}*\\n‚ö°Ô∏è Esfor√ßo: ${action.effort}\\n‚ú® Impacto: ${action.expected_impact}\\n`\n).join('\\n')}\\n*‚îÅ‚îÅ‚îÅ STRATEGIC INVESTMENTS (90 dias) ‚îÅ‚îÅ‚îÅ*\\n\\n${plan.strategic_investments_90_days.slice(0, 2).map((action, i) => \n  `*${i+1}. ${action.action}*\\nüìà Marcos: ${action.milestones.join(' ‚Üí ')}\\n`\n).join('\\n')}\\n*‚îÅ‚îÅ‚îÅ APPROACH PLAYBOOK ‚îÅ‚îÅ‚îÅ*\\n\\n*Primeira Intera√ß√£o:*\\nüìç ${analysis.approach_playbook.first_interaction.ideal_context}\\nüéØ ${analysis.approach_playbook.first_interaction.opening_strategy}\\n\\n*Conversation Hooks:*\\n${analysis.approach_playbook.first_interaction.conversation_hooks.map(h => `‚Ä¢ ${h}`).join('\\n')}\\n\\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n‚è± ${new Date(data.analyzed_at).toLocaleString('pt-BR')}`;\n\nreturn { message };"
      },
      "typeVersion": 2
    },
    {
      "id": "send-telegram-002",
      "name": "Send Telegram Report",
      "type": "n8n-nodes-base.telegram",
      "position": [1400, 550],
      "parameters": {
        "text": "={{ $json.message }}",
        "chatId": "YOUR_CHAT_ID",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "Markdown"
        }
      },
      "credentials": {
        "telegramApi": {
          "id": "telegram-api-cred",
          "name": "Telegram Bot API"
        }
      },
      "typeVersion": 1.2
    },
    {
      "id": "webhook-response-002",
      "name": "Webhook Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [1400, 400],
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "typeVersion": 1
    },
    {
      "id": "sticky-kpis-002",
      "name": "KPIs Tracking",
      "type": "n8n-nodes-base.stickyNote",
      "position": [180, 600],
      "parameters": {
        "color": 6,
        "width": 450,
        "height": 140,
        "content": "## üìà Next Steps\n\nAfter getting your gap analysis:\n1. Track KPIs weekly using Personal Brand Tracker\n2. Re-run this analysis monthly\n3. Adjust action plan based on progress\n4. Focus on Quick Wins first!"
      },
      "typeVersion": 1
    }
  ],
  "connections": {
    "Webhook Trigger": {
      "main": [
        [
          {
            "node": "Validate Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validate Input": {
      "main": [
        [
          {
            "node": "Prepare Gap Analysis Prompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Gap Analysis Prompt": {
      "main": [
        [
          {
            "node": "Claude Gap Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Claude Gap Analysis": {
      "main": [
        [
          {
            "node": "Parse Gap Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Gap Analysis": {
      "main": [
        [
          {
            "node": "Store Analysis",
            "type": "main",
            "index": 0
          },
          {
            "node": "Format Telegram Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Store Analysis": {
      "main": [
        [
          {
            "node": "Webhook Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Telegram Report": {
      "main": [
        [
          {
            "node": "Send Telegram Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2025-11-23T00:00:00.000Z",
      "updatedAt": "2025-11-23T00:00:00.000Z",
      "id": "eros-engine",
      "name": "EROS Engine"
    }
  ],
  "meta": {
    "templateCredsSetupCompleted": false,
    "instanceId": "eros-engine-instance"
  },
  "id": "eros-gap-analysis",
  "createdAt": "2025-11-23T00:00:00.000Z",
  "updatedAt": "2025-11-23T00:00:00.000Z"
}
